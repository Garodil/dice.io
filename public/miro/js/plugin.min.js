(()=>{"use strict";var e={703:(e,t)=>{function o(e){return e+""}function r(e,t){return e.classList?e.classList.add(t):-1==e.className.split(" ").indexOf(t)&&(e.className+=" "+t),e}function l(e,t){return o(t).split(" ").forEach((t=>{e=r(e,t)})),e}function i(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return void 0===o?e.getAttribute(t):(null===o?e.setAttributeNode(document.createAttribute(t)):e.setAttribute(t,o),e)}Object.defineProperty(t,"__esModule",{value:!0}),t.addClass=l,t.addOneClass=r,t.attr=i,t.el=function(e){return document.querySelector(e)},t.make=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=document.createElement(e);t.class&&(o=l(o,t.class));t.text&&(o.innerText=t.text);if(t.attr&&"object"==typeof t.attr)for(var r in t.attr)i(o,r,t.attr[r]);t.html&&(o.innerHTML=t.html);return o},t.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("\\b"+t+"\\b","g"),"");return e},t.str=o,t.toggleClass=function(e,t){if(e.classList)e.classList.toggle(t);else{var o=e.className.split(" "),r=o.indexOf(t);r>=0?o.splice(r,1):o.push(t),e.className=o.join(" ")}return e}},929:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(703);t.default=class{constructor(e){this._diceRoller=e,this._setupDiceRoller(),this._setupApp()}get formula(){return(0,r.el)(".diceroller-bottom__formula")}get rolls(){return(0,r.el)(".diceroller-rolls")}_setupApp(){this.formula.addEventListener("keyup",(e=>{13===e.keyCode&&(e.preventDefault(),(0,r.str)(this.formula.value).length>1?this._diceRoller.roll(this.formula.value):this._inputErrorAnimation(this.formula))})),this._IntlDateFormatter=new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric",second:"numeric"}),this._diceSound=new Audio("../mp3/dice.mp3")}_setupDiceRoller(){this._diceRoller.onError((()=>{this._inputErrorAnimation(this.formula)})).onDisconnect((e=>{console.log("Disconnected from "+e.serverUrl)})).onConnect((e=>{console.log("Connected to "+e.serverUrl)})).onHistory((e=>{this._onHistory(e)})).onRoll((e=>{this._onRoll(e)})).connect()}_onHistory(e){this._empty(this.rolls),e.forEach((e=>{this._appendRoll(e)})),this._scrollToBottom(this.rolls)}_onRoll(e){this._playRollSound(),this._appendRoll(e),this._scrollToBottom(this.rolls)}_playRollSound(){this._diceSound.load(),this._diceSound.play()}_appendRoll(e){var t=(0,r.make)("div",{class:"diceroller-roll"}),o=(0,r.make)("div",{class:"diceroller-roll__name"});o.appendChild((0,r.make)("span",{attr:{title:e.nickname},text:e.nickname})),t.appendChild(o);var l=(0,r.make)("div",{class:"diceroller-roll__time"});l.appendChild((0,r.make)("span",{text:this._formatTimestamp(e.timestamp)})),t.appendChild(l),t.appendChild((0,r.make)("div",{class:"clear"})),t.appendChild((0,r.make)("div",{class:"diceroller-roll__formula",text:e.roll.formula})),t.appendChild((0,r.make)("div",{class:"diceroller-roll__message",text:e.roll.message})),t.appendChild((0,r.make)("div",{class:"diceroller-roll__value",text:e.roll.value})),this.rolls.appendChild(t),this.rolls.appendChild((0,r.make)("div",{class:"diceroller-rolls__border"}))}_formatTimestamp(e){return this._IntlDateFormatter.format(new Date(e))}_empty(e){for(var t;t=e.lastChild;)e.removeChild(t)}_scrollToBottom(e){e.scrollTop=e.scrollHeight-e.clientHeight}_inputErrorAnimation(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input-error",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300;(0,r.addOneClass)(e,t),setTimeout((()=>{(0,r.removeClass)(e,t)}),o)}}},230:(e,t,o)=>{o.r(t)}},t={};function o(r){var l=t[r];if(void 0!==l)return l.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{o(230);var e,t=(e=o(929))&&e.__esModule?e:{default:e};function r(e,t,o,r,l,i,n){try{var s=e[i](n),a=s.value}catch(e){return void o(e)}s.done?t(a):Promise.resolve(a).then(r,l)}function l(e){return function(){var t=this,o=arguments;return new Promise((function(l,i){var n=e.apply(t,o);function s(e){r(n,l,i,s,a,"next",e)}function a(e){r(n,l,i,s,a,"throw",e)}s(void 0)}))}}function i(e,o){var r=window.location.pathname.replace(/miro\/sidebar\.html$/gi,""),l=new DiceIO({channel:o,nickname:e,serverUrl:window.location.origin,socketOptions:{path:r+"socket.io"}});new t.default(l)}function n(e){return e.toLowerCase().replace(/[^a-z0-9]/gi,"")}function s(){return(s=l((function*(){var e=yield miro.board.getUserInfo().catch((e=>{console.log("[Dice Roller] Failed to get user info",e)})),t=yield miro.board.getInfo().catch((e=>{console.log("[Dice Roller] Failed to get board info",e)}));if(!e.id||!t.id)throw new Error("[Dice Roller] failed to get required info");i("user_"+n(e.id),"miro"+n(t.id))}))).apply(this,arguments)}!function(){s.apply(this,arguments)}()})()})();